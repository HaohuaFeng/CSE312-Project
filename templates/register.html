<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Project Name</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.2/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="../static/js/default.js" charset="utf-8"></script>
</head>

<body>
    <h1>Project Name</h1>

    <div class="header">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="register.html" id="select_color">Register</a>
        {% if user %}
        <a href="profile.html" class="profile">{{user}}</a>
        <a href="/logout">Logout</a>
        {% else %}
        <a href="login.html">Login</a>
        {% endif %}
    </div>
    <div class="main">
        <div class="description">This is Register Page</div>
        <hr>
        <div class="register">
            <form name="register" method="post">
                <label for="username">Username:</label>
                <input type="text" name="username" id="username" required onkeyup="check_user()"><span id="display_exist"></span><br>
                <label for="email">E-mail :</label>
                <input type="email" name="email" id="email" required><br>
                <label for="password">Password :</label>
                <input type="password" name="password" id="password" required onkeyup="check_password_match()"><br>
                <label for="pcheck">Confirm Password: </label>
                <input type="password" name="pcheck" id="pcheck" required onkeyup="check_password_match()">
                <span id="checkpw"></span><br>
                <input type="submit" id="submit" value="Register">
            </form>
            <script>
                let username_check = false
                let password_check = false
                function check_user(){
                    const username = document.getElementById("username").value;
                    const url = "/username_validation/?username=" + username;
                    $.ajax(
                        {
                            url: url,
                            type: "get",
                            data: "",
                            success: function (get_from_server) {
                                if (get_from_server['exists']) {
                                    username_check = false
                                    document.getElementById("display_exist").innerHTML = get_from_server['display']
                                } else {
                                    username_check = true
                                    document.getElementById("display_exist").innerHTML = get_from_server['display']
                                }
                                if ((!username_check && !password_check) || !username_check || !password_check){
                                    document.getElementById("submit").disabled = true;
                                }
                                else {
                                    document.getElementById("submit").disabled = false;
                                }
                            }
                        }
                    )
                }
                function check_password_match() {
                    const pw = document.getElementById("password").value;
                    const cpw = document.getElementById("pcheck").value;
                    if (pw !== cpw) {
                        document.getElementById("checkpw").innerHTML = "<font color='red'> ❌ passwords are not matched</font>";
                        password_check = false
                    } else if (pw === cpw) {
                        document.getElementById("checkpw").innerHTML = "<font color='green'> ✔</font>";
                        password_check = true
                    }
                    if ((!username_check && !password_check) || !username_check || !password_check){
                        document.getElementById("submit").disabled = true;
                    }
                    else {
                        document.getElementById("submit").disabled = false;
                    }
                }
            </script>
        </div>
        <p class="casualCase">I have an account. <a href="/login.html">Login</a>.</p>
    </div>

</body>
</html>